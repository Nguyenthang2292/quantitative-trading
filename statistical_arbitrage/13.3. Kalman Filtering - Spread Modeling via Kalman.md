
# Spread Modeling via Kalman
### Mô hình không gian trạng thái cho Spread

Trong bối cảnh mô hình hóa spread, chúng ta muốn mô hình hóa $$y_{1t} \approx \mu_t + \gamma_t y_{2t}$$, trong đó $$\mu$$ và $$\gamma$$ thay đổi chậm theo thời gian. Điều này có thể thực hiện dễ dàng thông qua mô hình không gian trạng thái bằng cách xác định trạng thái ẩn là $$\alpha_t = (\mu_t, \gamma_t)$$, dẫn đến:

```math
y_{1t} = [1 \ y_{2t}] 
\begin{bmatrix}
\mu_t \\
\gamma_t
\end{bmatrix} 
+ \epsilon_t,
```

```math
\begin{bmatrix}
\mu_{t+1} \\
\gamma_{t+1}
\end{bmatrix} 
= 
\begin{bmatrix}
1 & 0 \\
0 & 1
\end{bmatrix}
\begin{bmatrix}
\mu_t \\
\gamma_t
\end{bmatrix} 
+ 
\begin{bmatrix}
\eta_{\mu_t} \\
\eta_{\gamma_t}
\end{bmatrix},
```

Trong đó:
- Tất cả các thành phần nhiễu đều độc lập và tuân theo phân phối:

  - $$\epsilon_t \sim \mathcal{N}(0, \sigma_\epsilon^2),$$

  - $$\eta_{\mu_t} \sim \mathcal{N}(0, \sigma_\mu^2),$$

  - $$\eta_{\gamma_t} \sim \mathcal{N}(0, \sigma_\gamma^2).$$

- Ma trận chuyển tiếp trạng thái là $$T = I$$, ma trận quan sát là $$Z_t = [1 \ y_{2t}]$$, và trạng thái ban đầu là:

  - $$\mu_1 \sim \mathcal{N}(\bar{\mu}_ 1, \sigma_{\mu_1}^2),$$
    
  - $$\gamma_1 \sim \mathcal{N}(\bar{\gamma}_ 1, \sigma_{\gamma_1}^2)$$.

### Spread Chuẩn hóa
Với đơn bày = 1 (xem công thức 15.2), spread chuẩn hóa có thể được tính:

$$z_t = \frac{1}{1 + \gamma_{t-1}} \left( y_{1t} - \gamma_{t-1} y_{2t} - \mu_{t-1} \right),$$

Trong đó $$\mu_{t-1}$$ và $$\gamma_{t-1}$$ là các trạng thái ẩn được ước tính bởi thuật toán Kalman.

### Ước tính các Tham số của Mô hình
Các tham số của mô hình không gian trạng thái ($$\sigma_\epsilon^2, \sigma_\mu^2, \sigma_\gamma^2$$) có thể được xác định bằng cách:

1. **Heuristic đơn giản:**
- Sử dụng dữ liệu huấn luyện $$T^{LS}$$ mẫu để ước tính $$\mu$$ và $$\gamma$$ thông qua bình phương nhỏ nhất (LS).
- Tính toán phần dư của $$LS_t$$, sau đó xác định tham số của mô hình:

   - $\sigma_\epsilon^2 = Var[ \epsilon_t ],$

   - $\mu_1 \sim \mathcal{N}(\mu_{\mu}, \sigma_{\mu}^2),$

   - $\gamma_1 \sim \mathcal{N}(\gamma_{\gamma}, \sigma_{\gamma}^2).$

2. **Tham số $$\alpha$$:**
- Xác định tỷ lệ biến động của các trạng thái ẩn thay đổi chậm so với biến động của spread.

### Mở Rộng Mô Hình Không Gian Trạng Thái
1. **Thêm Thành phần Vận tốc:**
   - Mô hình không chỉ xét đến hệ số phòng hộ $$\gamma_t$$ mà còn cả tốc độ thay đổi $$\dot{\gamma}_t$$:
   
$$\alpha_t = (\mu_t, \gamma_t, \dot{\gamma}_t),$$

dẫn đến:

```math
     \begin{bmatrix}
     \mu_{t+1} \\
     \gamma_{t+1} \\
     \dot{\gamma}_{t+1}
     \end{bmatrix}
     =
     \begin{bmatrix}
     1 & 0 & 0 \\
     0 & 1 & 1 \\
     0 & 0 & 1
     \end{bmatrix}
     \begin{bmatrix}
     \mu_t \\
     \gamma_t \\
     \dot{\gamma}_t
     \end{bmatrix}
     +
     \eta_t.
```

3. **Thành phần Tự hồi quy:**
   - Dưới khái niệm cointegration từng phần, mô hình spread với thành phần tự hồi quy được mở rộng:

$$\alpha_t = (\mu_t, \gamma_t, \epsilon_t),$$

dẫn đến:

```math
     \begin{bmatrix}
     \mu_{t+1} \\
     \gamma_{t+1} \\
     \epsilon_{t+1}
     \end{bmatrix}
     =
     \begin{bmatrix}
     1 & 0 & 0 \\
     0 & 1 & 0 \\
     0 & 0 & \rho
     \end{bmatrix}
     \begin{bmatrix}
     \mu_t \\
     \gamma_t \\
     \epsilon_t
     \end{bmatrix}
     +
     \eta_t,
```
 
trong đó $$|\rho| < 1$$ hoặc $$\rho$$ cố định ở giá trị hợp lý như $$\rho = 0.9$$.

### Kết luận
- Mô hình không gian trạng thái cung cấp một phương pháp linh hoạt và hiệu quả để mô hình hóa spread trong giao dịch cặp.
- Việc mở rộng mô hình với vận tốc hoặc thành phần tự hồi quy có thể cải thiện đáng kể hiệu suất dự báo và giao dịch.
