# Tương quan (correlation)

Tương quan **(correlation)** là một khái niệm cơ bản trong xác suất, dùng để mô tả mức độ liên hệ giữa hai biến ngẫu nhiên. Tương quan có thể được sử dụng cho chuỗi thời gian có tính dừng, nhưng <ins>**không phù hợp với chuỗi không dừng (non-stationary)**<ins>.

- Khi xét tương quan giữa hai tài sản tài chính, chúng ta thực chất xem xét tương quan giữa **lợi nhuận log** (*log-returns*) của chúng chứ không phải giữa **giá trực tiếp**.

Cụ thể, giả sử có hai chuỗi thời gian $$y_{1t}$$ và $$y_{2t}$$ (*log-price*), ta có thể tính **lợi nhuận log** (*log-returns*) như sau:


$\Delta y_{1t} = y_{1t} - y_{1(t-1)}, \quad \Delta y_{2t} = y_{2t} - y_{2(t-1)}$


Công thức tính hệ số tương quan:


$$\rho = \frac{\mathbb{E}[(\Delta y_{1t} - \mu_1)(\Delta y_{2t} - \mu_2)]}{\sqrt{\text{Var}(\Delta y_{1t}) \cdot \text{Var}(\Delta y_{2t})}}$$


- $$\mu_1$$ và $$\mu_2$$: trung bình của $$\Delta y_{1t}$$ và $$\Delta y_{2t}$$.
- Mẫu số là tích căn bậc hai phương sai ($$\text{Var}$$) của hai chuỗi lợi nhuận log để chuẩn hóa giá trị tương quan.

>Giá trị tương quan trong khoảng:
$$-1 \leq \rho \leq 1$$

### Ý nghĩa của Tương quan:

- $$\rho \approx 1$$: Hai chuỗi thời gian biến động đồng thời và theo cùng hướng (cùng tăng hoặc cùng giảm).
- $$\rho \approx -1$$: Hai chuỗi thời gian biến động ngược chiều nhau.
- $$\rho \approx 0$$: Hai chuỗi thời gian không có mối liên hệ.



### Giải thích:

- Tương quan thường được sử dụng để phân tích mức độ đồng biến của lợi nhuận giữa các tài sản tài chính.
- Chỉ nên sử dụng tương quan khi ***chuỗi thời gian có tính dừng***, bởi vì với chuỗi không dừng, giá trị tương quan có thể gây hiểu lầm do xu hướng dài hạn.



### Ví dụ Thực Tế:

Nếu **log-return** của EUR/USD và GBP/USD có tương quan cao ($$\rho \approx 0.9$$), điều đó cho thấy hai cặp tiền tệ có xu hướng biến động cùng chiều và nhà giao dịch có thể cân nhắc các chiến lược giao dịch kết hợp.

### Ví dụ code:
Tính correlation log-return EUR/USD và log-return GBP/USD và giải thích tại sao lại dùng log-return để tính toán
```python
# =====================================================================================================================================================
# VÍ DỤ CORRELATION CỦA 2 CHUỖI TIME SERIES
# cho tôi ví dụ đoạn code tính correlation lợi nhuận log EUR/USD và lợi nhuận log GBP/USD và giải thích tại sao lại dùng log return để tính toán
# =====================================================================================================================================================
# Import các thư viện cần thiết
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Tạo chuỗi thời gian giả lập giá đóng cửa của EUR/USD và GBP/USD
np.random.seed(42)
T = 200  # số lượng điểm dữ liệu
initial_price_eur = 1.1  # Giá ban đầu EUR/USD
initial_price_gbp = 1.3  # Giá ban đầu GBP/USD

returns_eur = np.random.normal(0, 0.001, T)  # Lợi nhuận ngẫu nhiên EUR/USD
returns_gbp = np.random.normal(0, 0.001, T)  # Lợi nhuận ngẫu nhiên GBP/USD

prices_eur = initial_price_eur * np.exp(np.cumsum(returns_eur))  # Chuỗi giá EUR/USD
prices_gbp = initial_price_gbp * np.exp(np.cumsum(returns_gbp))  # Chuỗi giá GBP/USD

# Tạo DataFrame chứa giá đóng cửa
df = pd.DataFrame({
    'EURUSD_Close': prices_eur,
    'GBPUSD_Close': prices_gbp
}, index=pd.date_range(start='2022-01-01', periods=T))

# Tính toán log-return (lợi nhuận log)
df['EURUSD_Log_Return'] = np.log(df['EURUSD_Close'] / df['EURUSD_Close'].shift(1))
df['GBPUSD_Log_Return'] = np.log(df['GBPUSD_Close'] / df['GBPUSD_Close'].shift(1))

# Loại bỏ giá trị NaN ở đầu chuỗi
df = df.dropna()

# Tính hệ số tương quan giữa log-return của EUR/USD và GBP/USD
correlation = df[['EURUSD_Log_Return', 'GBPUSD_Log_Return']].corr().iloc[0, 1]

# Vẽ biểu đồ log-return
plt.figure(figsize=(12, 5))
plt.plot(df.index, df['EURUSD_Log_Return'], label='EUR/USD Log Return', color='blue')
plt.plot(df.index, df['GBPUSD_Log_Return'], label='GBP/USD Log Return', color='orange')
plt.title('Log Return của EUR/USD và GBP/USD')
plt.xlabel('Time')
plt.ylabel('Log Return')
plt.legend()
plt.show()

correlation
```
