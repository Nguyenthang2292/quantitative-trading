***B·∫£n quy·ªÅn d·ªãch thu·∫≠t v√† di·ªÖn gi·∫£i thu·ªôc v·ªÅ justinnguyen92&copy; - [telegram](https://t.me/justinnguyen92)***
## 1. Pairs Trading c√≥ l·ª£i nhu·∫≠n kh√¥ng?
*Pairs trading* d·ª±a tr√™n gi·∫£ ƒë·ªãnh r·∫±ng m·ªëi quan h·ªá l·ªãch s·ª≠ gi·ªØa hai c√¥ng c·ª• t√†i ch√≠nh s·∫Ω ƒë∆∞·ª£c duy tr√¨ trong t∆∞∆°ng lai. Tuy nhi√™n, ƒëi·ªÅu n√†y kh√¥ng ph·∫£i l√∫c n√†o c≈©ng ƒë√∫ng v√¨ m·ªëi quan h·ªá *cointegration* c√≥ th·ªÉ thay ƒë·ªïi theo th·ªùi gian do nhi·ªÅu y·∫øu t·ªë nh∆∞:

- ƒêi·ªÅu ki·ªán th·ªã tr∆∞·ªùng.
- Xu h∆∞·ªõng ng√†nh.
- S·ª± ki·ªán c·ª• th·ªÉ li√™n quan ƒë·∫øn c√¥ng ty.
Do ƒë√≥, *pairs trading* ti·ªÅm ·∫©n r·ªßi ro v√† y√™u c·∫ßu nh√† giao d·ªãch ph·∫£i gi√°m s√°t ch·∫∑t ch·∫Ω m·ªëi quan h·ªá gi·ªØa c√°c c√¥ng c·ª•, c≈©ng nh∆∞ s·ª≠ d·ª•ng c√°c k·ªπ thu·∫≠t qu·∫£n l√Ω r·ªßi ro ƒë·ªÉ b·∫£o v·ªá v·ªã th·∫ø giao d·ªãch c·ªßa m√¨nh.

M·ªôt s·ªë nghi√™n c·ª©u cho th·∫•y *pairs trading* c√≥ th·ªÉ t·∫°o ra l·ª£i nhu·∫≠n *(Avellaneda & Lee, 2010; Elliott et al., 2005; Gatev et al., 2006)*, trong khi nh·ªØng nghi√™n c·ª©u kh√°c cho r·∫±ng m·ªëi quan h·ªá cointegration kh√¥ng ƒë∆∞·ª£c duy tr√¨ ·ªïn ƒë·ªãnh theo th·ªùi gian *(Chan, 2013; Clegg, 2014)*.

## Nh·ªØng c·∫£nh b√°o khi s·ª≠ d·ª•ng *Pairs Trading*:
1. Chi ph√≠ giao d·ªãch:
 - Ph√≠ giao d·ªãch c√≥ th·ªÉ l·ªõn h∆°n c·∫£ l·ª£i nhu·∫≠n ki·∫øm ƒë∆∞·ª£c t·ª´ *spread*.

2. Hi·ªáu qu·∫£ gi·∫£m d·∫ßn:
 - M·ªôt chi·∫øn l∆∞·ª£c t·ª´ng hi·ªáu qu·∫£ trong qu√° kh·ª© c√≥ th·ªÉ kh√¥ng c√≤n hi·ªáu qu·∫£ trong th·ªùi gian g·∫ßn ƒë√¢y.

3. Kh√≥ khƒÉn k·ªπ thu·∫≠t:
 - Thanh kho·∫£n th·∫•p khi b√°n kh·ªëng.
 - Nguy c∆° *margin call* (b·ªã y√™u c·∫ßu b·ªï sung k√Ω qu·ªπ khi gi√° bi·∫øn ƒë·ªông b·∫•t l·ª£i).
 - C·∫°nh tranh gi·ªØa c√°c nh√† giao d·ªãch t·∫ßn su·∫•t cao.

## Gi·∫£i ph√°p:
- S·ª≠ d·ª•ng l·ªçc Kalman *(Kalman Filter)* ƒë·ªÉ ∆∞·ªõc t√≠nh m·ªôt m·ªëi quan h·ªá *cointegration* thay ƒë·ªïi theo th·ªùi gian.
- S·ª≠ d·ª•ng m√¥ h√¨nh **VECM** *(Vector Error Correction Model)* ƒë·ªÉ kh·∫Øc ph·ª•c c√°c h·∫°n ch·∫ø v·ªÅ *cointegration*.

## 2. Thi·∫øt k·∫ø Pairs Trading
Ph·∫ßn n√†y gi·ªõi thi·ªáu chi ti·∫øt v·ªÅ thi·∫øt k·∫ø chi·∫øn l∆∞·ª£c pairs trading. M·ª•c ti√™u c·ªßa chi·∫øn l∆∞·ª£c l√† giao d·ªãch m·ªôt *spread* h·ªìi quy v·ªÅ trung b√¨nh c√≥ l·ª£i nhu·∫≠n, bao g·ªìm c√°c b∆∞·ªõc ch√≠nh nh∆∞:
1. X√°c ƒë·ªãnh c·∫∑p t√†i s·∫£n c√≥ quan h·ªá *cointegration*:
- T·ª´ c√°c b∆∞·ªõc s√†ng l·ªçc c∆° b·∫£n ƒë·∫øn c√°c ki·ªÉm tra th·ªëng k√™ ph·ª©c t·∫°p.
2. Thi·∫øt k·∫ø chi·∫øn l∆∞·ª£c giao d·ªãch:
- D·ª±a tr√™n vi·ªác l·ª±a ch·ªçn ng∆∞·ª°ng $$ùë†_0$$ ho·∫∑c s·ª≠ d·ª•ng c√°c ph∆∞∆°ng ph√°p ph·ª©c t·∫°p h∆°n.

**C√°c ph∆∞∆°ng ph√°p n√¢ng cao:**
- L·ªçc *Kalman*: D√πng ƒë·ªÉ ∆∞·ªõc t√≠nh m·ªôt m·ªëi quan h·ªá *cointegration* thay ƒë·ªïi theo th·ªùi gian.
- M·ªü r·ªông *pairs trading*: √Åp d·ª•ng chi·∫øn l∆∞·ª£c n√†y cho h∆°n hai t√†i s·∫£n.

## 3. Pre-screening (S√†ng l·ªçc s∆° b·ªô)
### 1. T·ªïng quan v·ªÅ Prescreening:
S√†ng l·ªçc s∆° b·ªô (*pre-screening*) l√† m·ªôt qu√° tr√¨nh ƒë∆°n gi·∫£n v√† ti·∫øt ki·ªám chi ph√≠, trong ƒë√≥ nhi·ªÅu c·∫∑p t√†i s·∫£n c√≥ th·ªÉ ƒë∆∞·ª£c lo·∫°i b·ªè m·ªôt c√°ch nhanh ch√≥ng, ch·ªâ gi·ªØ l·∫°i m·ªôt s·ªë c·∫∑p ti·ªÅm nƒÉng ƒë·ªÉ ph√¢n t√≠ch s√¢u h∆°n.
M·ªôt th∆∞·ªõc ƒëo ph·ªï bi·∫øn ƒë·ªÉ ƒë√°nh gi√° *cointegration* l√† kho·∫£ng c√°ch gi√° chu·∫©n h√≥a ***(Normalized Price Distance - NPD)***.

### 2. C√¥ng th·ª©c NPD:
```math
\text{NPD} = \sum_{t=1}^{T} \left( \tilde{p}_{1t} - \tilde{p}_{2t} \right)^2
```
**Trong ƒë√≥:**
- $$\tilde{p}_ {1t}$$ v√† $$\tilde{p}_{2t}$$ l√† gi√° chu·∫©n h√≥a:
  
```math
  \tilde{p}_{1t} = \frac{p_{1t}}{p_{10}}, \quad \tilde{p}_{2t} = \frac{p_{2t}}{p_{20}}
```
  - $$p_{1t}, p_{2t}$$ l√† gi√° g·ªëc c·ªßa hai t√†i s·∫£n.
  - $$p_{10}, p_{20}$$ l√† gi√° t·∫°i th·ªùi ƒëi·ªÉm ban ƒë·∫ßu.

**√ù nghƒ©a:**
- NPD ƒëo l∆∞·ªùng s·ª± kh√°c bi·ªát gi·ªØa c√°c gi√° chu·∫©n h√≥a theo th·ªùi gian. N·∫øu NPD nh·ªè, nghƒ©a l√† s·ª± kh√°c bi·ªát gi·ªØa c√°c gi√° chu·∫©n h√≥a ·ªïn ƒë·ªãnh trong d√†i h·∫°n ‚Üí c·∫∑p t√†i s·∫£n c√≥ ti·ªÅm nƒÉng *cointegration*.

### 3. Prescreening v·ªõi Log-Prices (gi√° log):
M·ªôt th∆∞·ªõc ƒëo t∆∞∆°ng t·ª± c≈©ng c√≥ th·ªÉ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a v·ªõi *log-prices* \( y_{1t} \) v√† \( y_{2t} \) b·∫±ng c√°ch tr·ª´ ƒëi gi√° tr·ªã t·∫°i th·ªùi ƒëi·ªÉm ban ƒë·∫ßu:
```math
\tilde{y}_{1t} = y_{1t} - y_{10}, \quad \tilde{y}_{2t} = y_{2t} - y_{20}
```

- Chu·ªói $$\tilde{y}_ {1t}$$ v√† $$\tilde{y}_{2t}$$ ƒë·∫°i di·ªán cho s·ª± kh√°c bi·ªát d√†i h·∫°n c·ªßa chu·ªói gi√° log (t∆∞∆°ng t·ª± *log-returns*).

### 4. √ù nghƒ©a th·ª±c t·∫ø:
- *Pre-screening* gi√∫p nhanh ch√≥ng lo·∫°i b·ªè nh·ªØng c·∫∑p t√†i s·∫£n kh√¥ng c√≥ ti·ªÅm nƒÉng *cointegration* ƒë·ªÉ t·∫≠p trung ph√¢n t√≠ch k·ªπ h∆°n v√†o c√°c c·∫∑p c√≥ gi√° tr·ªã NPD nh·ªè.
- ƒêi·ªÅu n√†y l√†m gi·∫£m th·ªùi gian v√† chi ph√≠ t√≠nh to√°n khi th·ª±c hi·ªán chi·∫øn l∆∞·ª£c *pairs trading* tr√™n nhi·ªÅu c·∫∑p t√†i s·∫£n.

### T√≥m t·∫Øt:
- *Prescreening* l√† b∆∞·ªõc ƒë·∫ßu ti√™n trong quy tr√¨nh t√¨m ki·∫øm c·∫∑p t√†i s·∫£n *cointegration* ti·ªÅm nƒÉng.
- NPD ƒëo l∆∞·ªùng s·ª± kh√°c bi·ªát gi·ªØa c√°c gi√° chu·∫©n h√≥a theo th·ªùi gian. N·∫øu NPD th·∫•p, hai chu·ªói th·ªùi gian c√≥ th·ªÉ c√≥ m·ªëi quan h·ªá *cointegration* m·∫°nh.
- Ph∆∞∆°ng ph√°p n√†y c≈©ng c√≥ th·ªÉ √°p d·ª•ng cho *log-prices* ƒë·ªÉ ƒëo l∆∞·ªùng c√°c bi·∫øn ƒë·ªông d√†i h·∫°n c·ªßa chu·ªói th·ªùi gian.

### V√≠ d·ª• code:
V√≠ d·ª• ph∆∞∆°ng ph√°p **NPD** v√† **Log-Prices** v·ªõi 1 list c√°c pair v√≠ d·ª•: pairs = ["EURUSD", "GBPUSD", "USDJPY", "AUDUSD", "USDCAD", "USDCHF", "NZDUSD"] (s·ª≠ d·ª•ng gi√° [close] cho m·ªói pair)
```python
# Reimport necessary libraries after the environment reset
import pandas as pd
import numpy as np
from itertools import combinations
import matplotlib.pyplot as plt

# T·∫°o chu·ªói d·ªØ li·ªáu gi·∫£ l·∫≠p cho c√°c c·∫∑p ti·ªÅn t·ªá
np.random.seed(42)
T = 200  # S·ªë l∆∞·ª£ng ƒëi·ªÉm d·ªØ li·ªáu
pairs = ["EURUSD", "GBPUSD", "USDJPY", "AUDUSD", "USDCAD", "USDCHF", "NZDUSD"]
prices_data = {}

# Gi·∫£ l·∫≠p d·ªØ li·ªáu gi√° ƒë√≥ng c·ª≠a cho m·ªói c·∫∑p ti·ªÅn t·ªá
for pair in pairs:
    initial_price = np.random.uniform(1.0, 2.0)  # Gi√° ban ƒë·∫ßu ng·∫´u nhi√™n
    returns = np.random.normal(0, 0.01, T)  # L·ª£i nhu·∫≠n ng·∫´u nhi√™n
    prices_data[pair] = initial_price * np.exp(np.cumsum(returns))  # Gi√° ƒë√≥ng c·ª≠a gi·∫£ l·∫≠p

# T·∫°o DataFrame ch·ª©a gi√° ƒë√≥ng c·ª≠a c·ªßa t·∫•t c·∫£ c√°c c·∫∑p ti·ªÅn t·ªá
df_prices = pd.DataFrame(prices_data, index=pd.date_range(start='2022-01-01', periods=T))

# T√≠nh to√°n kho·∫£ng c√°ch gi√° chu·∫©n h√≥a (NPD) cho t·ª´ng c·∫∑p
npd_results = {}
for pair1, pair2 in combinations(pairs, 2):
    # Gi√° chu·∫©n h√≥a
    norm_prices_1 = df_prices[pair1] / df_prices[pair1].iloc[0]
    norm_prices_2 = df_prices[pair2] / df_prices[pair2].iloc[0]
    # T√≠nh NPD
    npd = np.sum((norm_prices_1 - norm_prices_2) ** 2)
    npd_results[(pair1, pair2)] = npd

# T√≠nh to√°n log-prices
log_prices = np.log(df_prices)

# T√≠nh to√°n kho·∫£ng c√°ch log-prices cho t·ª´ng c·∫∑p
log_distance_results = {}
for pair1, pair2 in combinations(pairs, 2):
    shifted_log_1 = log_prices[pair1] - log_prices[pair1].iloc[0]
    shifted_log_2 = log_prices[pair2] - log_prices[pair2].iloc[0]
    log_distance = np.sum((shifted_log_1 - shifted_log_2) ** 2)
    log_distance_results[(pair1, pair2)] = log_distance

# Chuy·ªÉn k·∫øt qu·∫£ th√†nh DataFrame ƒë·ªÉ d·ªÖ quan s√°t
npd_df = pd.DataFrame.from_dict(npd_results, orient='index', columns=['NPD'])
log_distance_df = pd.DataFrame.from_dict(log_distance_results, orient='index', columns=['Log-Price Distance'])

# S·∫Øp x·∫øp theo th·ª© t·ª± tƒÉng d·∫ßn
npd_df_sorted = npd_df.sort_values(by='NPD')
log_distance_df_sorted = log_distance_df.sort_values(by='Log-Price Distance')

# Hi·ªÉn th·ªã k·∫øt qu·∫£
print(npd_df_sorted,log_distance_df_sorted)
```
### Result
>![image](https://github.com/user-attachments/assets/c2912084-a6ca-4678-8d01-9826c0ecb66f)

T√¥i ƒë√£ t√≠nh to√°n kho·∫£ng c√°ch gi√° chu·∫©n h√≥a *(NPD)* v√† kho·∫£ng c√°ch *log-prices* cho t·∫•t c·∫£ c√°c c·∫∑p ti·ªÅn t·ªá trong danh s√°ch. B·∫°n c√≥ th·ªÉ xem b·∫£ng k·∫øt qu·∫£ ƒë·ªÉ t√¨m ra c√°c c·∫∑p c√≥ kho·∫£ng c√°ch th·∫•p nh·∫•t, ti·ªÅm nƒÉng c√≥ *cointegration* m·∫°nh m·∫Ω. C√°c c·∫∑p c√≥ gi√° tr·ªã *(NPD)* v√† *log-price distance* th·∫•p h∆°n th∆∞·ªùng ƒë∆∞·ª£c ∆∞u ti√™n ƒë·ªÉ ph√¢n t√≠ch chi ti·∫øt h∆°n trong chi·∫øn l∆∞·ª£c *pairs trading*.

