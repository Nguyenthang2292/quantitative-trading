***Bản quyền dịch thuật và diễn giải thuộc về justinnguyen92&copy; - [telegram](https://t.me/justinnguyen92)***
Sau khi hoàn tất quá trình *pre-screening* các cặp tài sản có tiềm năng *cointegration*, cần thực hiện một phân tích kỹ lưỡng hơn. Đây là vai trò của các **kiểm định đồng tích hợp (*cointegration tests*)** được phát triển trong lĩnh vực thống kê từ nhiều thập kỷ trước *(Harris, 1995; Tsay, 2010, 2013)*.

### Ý nghĩa của *Cointegration Tests*:
- Các kiểm định này nhằm kiểm tra xem liệu có một tổ hợp tuyến tính nào đó của hai chuỗi thời gian tạo thành một mô hình tự hồi quy dừng *(stationary autoregressive model)* hay không.
- Nếu chuỗi không có gốc đơn *(non-stationary)*, chuỗi sẽ hành xử như một *random walk* và không hồi quy về trung bình.
- Nếu chuỗi có gốc đơn, chuỗi thời gian sẽ có xu hướng quay trở lại mức trung bình dài hạn.

### Công thức toán học:
Mục tiêu là kiểm tra xem có tồn tại một giá trị $$\gamma$$ sao cho chuỗi *spread*:

$$z_t = y_{1t} - \gamma y_{2t}$$

là một chuỗi dừng.

- Trong thực tế, mức trung bình của *spread* $$\mu$$ (giá trị cân bằng) không nhất thiết phải bằng $$0$$ và $$\gamma$$ không phải lúc nào cũng bằng $$1$$.
- Nhiều nghiên cứu đặt $$\gamma = 1$$ để đơn giản hóa trong các chiến lược giao dịch trung lập thị trường *(dollar-neutral strategies)*, nhưng điều này làm giảm số lượng cặp tài sản *cointegration*.

### Phương pháp kiểm định phổ biến: Engle-Granger Test

Một trong những phương pháp đơn giản và phổ biến nhất để kiểm tra *cointegration* là **kiểm định Engle-Granger** *(Engle và Granger, 1987)*.
- **Bước 1**: Ước lượng giá trị $$\gamma$$ thông qua Hồi quy tuyến tính bình phương tối thiểu (*OLS*).
- **Bước 2**: Kiểm tra tính dừng của phần dư (*residual*):
```math
  y_{1t} - \gamma y_{2t} = \mu + r_t
```
  - $$r_t$$: phần dư sau khi hồi quy.

## Giải thích chi tiết:
- **Kiểm định Engle-Granger**: Kiểm định này dựa trên việc kiểm tra xem phần dư $$r_t$$ có tính dừng hay không. Nếu phần dư là chuỗi dừng, điều này chứng tỏ rằng hai chuỗi thời gian $$y_{1t}$$ và $$y_{2t}$$ có mối quan hệ *cointegration*.
- **Ý nghĩa của $$\gamma$$**:
  - Giá trị $$\gamma$$ là hệ số xác định mối quan hệ giữa hai chuỗi thời gian.
  - Nếu $$\gamma$$ quá khác biệt so với 1 hoặc không cho thấy tính dừng, cặp tài sản có thể không *cointegration*.

## Tóm tắt:
- Sau khi sàng lọc sơ bộ các cặp tài sản tiềm năng, cần kiểm tra chính xác bằng các kiểm định *cointegration*.
- Phương pháp *Engle-Granger* là một trong những phương pháp kiểm tra đơn giản và phổ biến nhất, dựa trên việc xác định phần dư từ Hồi quy bình phương tối thiểu *(least squares regression)* giữa hai chuỗi tài sản.
- Nếu phần dư là chuỗi dừng, hai chuỗi có *cointegration* và có thể được sử dụng trong chiến lược *pairs trading*.
> :memo: **Note:** Hồi quy bình phương tối thiểu *(least squares regression)* là một kỹ thuật cụ thể (và phổ biến nhất) để thực hiện *Linear Regression* (*Linear Regression* là mô hình tổng quát).

### Ví dụ code:
Kiểm định mẫu Engle-Granger với 2 time-series EURUSD và GBPUSD (2 cặp lấy giá [close]).
```python
# Reimport libraries after environment reset
import numpy as np
import pandas as pd
import statsmodels.api as sm
from statsmodels.tsa.stattools import adfuller

# Giả lập dữ liệu giá đóng cửa cho EUR/USD và GBP/USD
np.random.seed(42)
T = 200  # Số lượng điểm dữ liệu
initial_price_eur = 1.1  # Giá ban đầu EUR/USD
initial_price_gbp = 1.3  # Giá ban đầu GBP/USD

# Lợi nhuận ngẫu nhiên và giá giả lập
returns_eur = np.random.normal(0, 0.01, T)
returns_gbp = np.random.normal(0, 0.01, T)

prices_eur = initial_price_eur * np.exp(np.cumsum(returns_eur))
prices_gbp = initial_price_gbp * np.exp(np.cumsum(returns_gbp))

# Tạo DataFrame chứa giá đóng cửa
df = pd.DataFrame({
    'EURUSD_Close': prices_eur,
    'GBPUSD_Close': prices_gbp
})

# 1. Hồi quy OLS để ước lượng gamma
X = sm.add_constant(df['GBPUSD_Close'])  # Thêm hằng số để hồi quy
model = sm.OLS(df['EURUSD_Close'], X).fit()
gamma = model.params['GBPUSD_Close']  # Hệ số gamma

# 2. Tính phần dư (residuals)
df['Spread'] = df['EURUSD_Close'] - gamma * df['GBPUSD_Close']

# 3. Kiểm tra tính dừng của phần dư bằng ADF Test
adf_result = adfuller(df['Spread'].dropna())
p_value = adf_result[1]

# Kết quả kiểm định Engle-Granger
conclusion = "Có đồng tích hợp" if p_value < 0.05 else "Không có đồng tích hợp"

# Hiển thị kết quả
gamma, p_value, conclusion
```
### Result
>(-0.09752042728106353, 0.22339005729108385, 'Không có đồng tích hợp')

### Kết quả Kiểm định Engle-Granger cho EUR/USD và GBP/USD

- **Hệ số gamma ($$\gamma$$)**: -0.0975
- **P-value của kiểm định ADF**: 0.2234 (> 0.05)
- **Kết luận**: "Không có cointegratiob"
  → Phần dư *(residuals)* không phải là chuỗi dừng, cho thấy hai chuỗi giá giả lập EUR/USD và GBP/USD không có mối quan hệ đồng tích hợp trong dài hạn.

### Giải thích:
Mặc dù hồi quy cho thấy có một mối quan hệ giữa hai chuỗi - giá trị $$\gamma$$ âm cho thấy giá GBP/USD có xu hướng ngược chiều với EUR/USD trong mối quan hệ này. Tuy nhiên, nếu giá trị $$\gamma$$ không đáng kể (như trong ví dụ xấp xỉ = 0), điều đó ám chỉ rằng mối quan hệ giữa hai chuỗi không ổn định., nhưng kiểm định Engle-Granger cho thấy sự khác biệt giữa chúng không ổn định trong dài hạn, vì vậy cặp này không thích hợp cho chiến lược *pairs trading*.

