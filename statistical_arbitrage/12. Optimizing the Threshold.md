Xem xét chiến lược **thresholded strategy** đơn giản, trong đó:
- **Mua:** Khi *z-score* giảm xuống dưới ngưỡng $$-s_0$$.
- **Bán khống:** Khi *z-score* vượt lên trên ngưỡng $$+s_0$$.
- **Đóng vị thế (unwinding):** Khi *z-score* quay trở lại giá trị cân bằng (zero).

Lưu ý rằng, theo ngữ cảnh của spread, ngưỡng $$s_0$$ được định nghĩa là:

$$s_0 \times \sigma$$

**Trong đó:**
- $$\sigma$$: Độ lệch chuẩn của spread.

Việc lựa chọn giá trị ngưỡng $$s_0$$ là rất quan trọng vì nó xác định:
1. **Tần suất vị thế được đóng (chốt lời).**
2. **Lợi nhuận tối thiểu đạt được trên mỗi giao dịch.**

Tổng lợi nhuận bằng số lần giao dịch nhân với lợi nhuận của mỗi giao dịch. Khi vị thế được đóng sau $$k$$ kỳ, ý nghĩa của sự khác biệt spread $$z_{t+k} - z_t$$ phụ thuộc vào việc spread biểu thị **log-prices** hay **prices**:
- **Log-prices:** Chênh lệch spread biểu thị log-return (lợi nhuận log).
- **Prices:** Chênh lệch spread biểu thị lợi nhuận tuyệt đối (*absolute profit*).

Do đó, sau $$N_{trades}$$ giao dịch thành công, tổng lợi nhuận (chưa gộp lãi) có thể được tính là:

$$N_{trades} \times s_0 \times \sigma$$

(Lợi nhuận gộp lãi - *compounded profit* cũng có thể được sử dụng).

Phần tiếp theo sẽ xác định giá trị ngưỡng tối ưu $$s_0$$ để tối đa hóa tổng lợi nhuận trong cả hai cách tiếp cận tham số và phi tham số.

### Diễn giải chi tiết:
1. **Ngưỡng giao dịch $$(s_0$$):**
   - Ngưỡng $$s_0$$ được sử dụng để xác định mức độ phân kỳ cần thiết trước khi thực hiện giao dịch.
   - Ngưỡng này là thước đo độ nhạy của chiến lược:
     - **Ngưỡng nhỏ** → Giao dịch thường xuyên hơn, nhưng lợi nhuận mỗi giao dịch thấp.
     - **Ngưỡng lớn** → Giao dịch ít hơn, nhưng lợi nhuận mỗi giao dịch cao hơn.

2. **Ý nghĩa của spread:**
   - Nếu spread được đo bằng log-prices, chênh lệch spread đại diện cho lợi nhuận log (*log-return*).
   - Nếu spread được đo bằng prices, chênh lệch spread đại diện cho lợi nhuận tuyệt đối (*absolute profit*).

3. **Tổng lợi nhuận:**
   - Lợi nhuận tổng hợp là sản phẩm của:
     - **Số lần giao dịch thành công** $$(N_{trades}$$).
     - **Lợi nhuận tối thiểu của mỗi giao dịch** $$(s_0 \cdot \sigma$$).

4. **Mục tiêu:**
   - Xác định giá trị tối ưu của $$s_0$$ để cân bằng giữa tần suất giao dịch và lợi nhuận mỗi giao dịch nhằm tối đa hóa tổng lợi nhuận.

## Kết luận:
- Chiến lược **thresholded strategy** phụ thuộc vào việc lựa chọn ngưỡng $$s_0$$, giúp tối ưu hóa lợi nhuận dựa trên mức độ phân kỳ và hồi quy của spread.
- Trong thực tế, giá trị $$s_0$$ phải được điều chỉnh phù hợp với dữ liệu lịch sử và điều kiện thị trường cụ thể để đạt hiệu quả cao nhất.

# Parametric Approach
Giả sử z-score tuân theo phân phối chuẩn chuẩn hóa:

$$z_{score} \sim \mathcal{N}(0, 1)$$

Khi đó, xác suất z-score lệch khỏi giá trị trung bình 0 với biên độ lớn hơn hoặc bằng $$s_0$$ là:

$$1 - \Phi(s_0)$$

**Trong đó:**
- $$\Phi(\cdot)$$: Hàm phân phối tích lũy (CDF) của phân phối chuẩn.

Với chuỗi thời gian có $$T$$ giai đoạn, số sự kiện giao dịch khả thi (theo một hướng) có thể được xấp xỉ:

$$T \times \left(1 - \Phi(s_0)\right)$$

**Lợi nhuận tổng thể là:**

$$T \times \left(1 - \Phi(s_0)\right) \times s_0$$

Dưới mô hình tham số đơn giản này, ngưỡng tối ưu $$s_0^*$$ có thể được tìm thấy bằng cách:

$$s_0^* = \arg \max_{s_0} \left[(1 - \Phi(s_0)) \cdot s_0 \right]$$

Hình 15.15 minh họa cách đánh giá tham số của lợi nhuận so với ngưỡng $$s_0$$ cho một chuỗi spread Gaussian tổng hợp.
![image](https://github.com/user-attachments/assets/b73faef1-f494-4142-a284-b47191dad55c)

## Diễn giải chi tiết:
1. **Giả định về Z-score:**
   - Z-score được giả định tuân theo phân phối chuẩn chuẩn hóa $$\mathcal{N}(0, 1)$$, điều này phù hợp với thực tế vì z-score là sự chuẩn hóa của spread dựa trên trung bình và phương sai.

2. **Xác suất giao dịch:**
   - Xác suất z-score vượt qua ngưỡng $$s_0$$ (trong một hướng, tức là chỉ giao dịch mua hoặc bán) là:

$$1 - \Phi(s_0)$$

   - Do đó, số sự kiện giao dịch có thể xảy ra trong chuỗi thời gian $$T$$ là:

$$T \times (1 - \Phi(s_0))$$

3. **Lợi nhuận tổng thể:**
   - Lợi nhuận mỗi giao dịch tối thiểu là $$s_0$$.
   - Lợi nhuận tổng thể (chưa gộp lãi) là:
     
$$T \times (1 - \Phi(s_0)) \times s_0$$

   - Công thức này thể hiện rằng lợi nhuận phụ thuộc vào ngưỡng $$s_0$$:
     - Ngưỡng $$s_0$$ lớn hơn → ít giao dịch nhưng lợi nhuận mỗi giao dịch cao hơn.
     - Ngưỡng $$s_0$$ nhỏ hơn → nhiều giao dịch nhưng lợi nhuận mỗi giao dịch thấp hơn.

4. **Ngưỡng tối ưu ($$s_0^*$$):**
   - Ngưỡng tối ưu $$s_0^*$$ được xác định bằng cách tối đa hóa hàm lợi nhuận tổng thể:

$$s_0^* = \arg \max_{s_0} \left[(1 - \Phi(s_0)) \cdot s_0 \right]$$

## Kết luận:
- **Parametric Approach:** Cung cấp cách tiếp cận có hệ thống để tối ưu hóa ngưỡng giao dịch $$s_0$$, dựa trên giả định về phân phối của z-score.
- **Ứng dụng thực tế:** Giá trị $$s_0^*$$ sẽ tối ưu hóa sự cân bằng giữa tần suất giao dịch và lợi nhuận mỗi giao dịch, giúp tối đa hóa tổng lợi nhuận.
- **Hạn chế:** Phương pháp này giả định phân phối chuẩn của z-score, có thể không hoàn toàn đúng với dữ liệu thực tế.

# Nonparametric Data-Driven Approach
Một phương pháp thay thế cho cách tiếp cận tham số *(parametric approach)* là phương pháp dựa trên dữ liệu phi tham số *(nonparametric data-driven approach)*. Phương pháp này không dựa vào bất kỳ giả định mô hình nào. Ý tưởng chính là sử dụng dữ liệu sẵn có để thực nghiệm tính toán số lượng sự kiện giao dịch cho mỗi ngưỡng có thể.

Cho $$T$$ quan sát của z-score, $$z_t^{score}$$, và $$J$$ giá trị ngưỡng được phân rời, $$s_{0,1}, \dots, s_{0,J}$$, ta có thể tính toán tần suất giao dịch thực nghiệm cho mỗi ngưỡng $$s_{0,j}$$ (theo một hướng) như sau:

$$f_j = \frac{1}{T} \sum_{t=1}^T \mathbf{1}\{z_t^{score} > s_{0,j}\}$$

Trong đó:
- $$\mathbf{1}\{\}$$ là hàm chỉ báo, trả về giá trị 1 nếu điều kiện đúng và 0 nếu sai.

Tuy nhiên, các giá trị thực nghiệm $$f_j$$ có thể rất nhiều *noise*, điều này có thể ảnh hưởng đến việc đánh giá tổng lợi nhuận. Một cách để giảm nhiễu trong các giá trị này là tăng tính trơn và giảm sự dao động giữa các giá trị liên tiếp. Chúng ta có thể tìm một phiên bản mượt hơn bằng cách giải bài toán **bình phương tối thiểu** *(least squares)*:

$$\min_f \sum_{j=1}^J (f_j - \bar{f_j})^2 + \lambda \sum_{j=1}^{J-1} (f_j - f_{j+1})^2$$

Trong đó:
- Thành phần đầu tiên đo lường sự khác biệt giữa giá trị $$f_j$$ nhiều và giá trị mượt.
- Thành phần thứ hai đảm bảo tính mượt mà, được kiểm soát bởi siêu tham số $$\lambda$$.

Bài toán này có thể viết gọn hơn dưới dạng:

$$\min_f \|f - \bar{f}\|_2^2 + \lambda \|D f\|_2^2$$

Trong đó:
- $$D$$ là ma trận sai phân (*difference matrix*), được định nghĩa như sau:

```math
D =
\begin{bmatrix}
1 & -1 & 0 & \cdots & 0 \\
0 & 1 & -1 & \cdots & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
0 & 0 & 0 & \cdots & -1
\end{bmatrix}
\in \mathbb{R}^{(J-1) \times J}
```

Do đây là bài toán bình phương tối thiểu, lời giải có dạng đóng (*closed-form*):

$$f^* = (I + \lambda D^\top D)^{-1} \bar{f}$$

Cuối cùng, ngưỡng tối ưu có thể được tìm bằng cách tối đa hóa tổng lợi nhuận đã được làm mượt:

$$s_{0,j}^* = \arg \max_{s_{0,j}} f_j$$

Hình 15.16 minh họa việc đánh giá phi tham số về lợi nhuận so với ngưỡng, cho thấy phiên bản dữ liệu mượt hơn và ít nhiễu gốc.
![image](https://github.com/user-attachments/assets/6e80b7fa-5c12-4b87-a470-ec0788d29991)


  
