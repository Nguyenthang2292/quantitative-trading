
# *Spread Modeling* thông qua *Kalman*
## Mô hình không gian trạng thái cho *Spread*

Trong bối cảnh mô hình hóa *spread*, chúng ta muốn mô hình hóa $y_{1t} \approx \mu_t + \gamma_t y_{2t}$, trong đó $\mu$ và $\gamma$ thay đổi chậm theo thời gian. Điều này có thể thực hiện dễ dàng thông qua mô hình không gian trạng thái bằng cách xác định trạng thái ẩn là $\alpha_t = (\mu_t, \gamma_t)$, dẫn đến:

```math
y_{1t} = [1 \ y_{2t}] 
\begin{bmatrix}
\mu_t \\
\gamma_t
\end{bmatrix} 
+ \epsilon_t,
```

```math
\begin{bmatrix}
\mu_{t+1} \\
\gamma_{t+1}
\end{bmatrix} 
= 
\begin{bmatrix}
1 & 0 \\
0 & 1
\end{bmatrix}
\begin{bmatrix}
\mu_t \\
\gamma_t
\end{bmatrix} 
+ 
\begin{bmatrix}
\eta_{\mu_t} \\
\eta_{\gamma_t}
\end{bmatrix},
```

**Trong đó:**
- Tất cả các thành phần nhiễu đều độc lập và tuân theo phân phối:
  - $\epsilon_t \sim \mathcal{N}(0, \sigma_\epsilon^2),$
  - $\eta_{\mu_t} \sim \mathcal{N}(0, \sigma_\mu^2),$
  - $\eta_{\gamma_t} \sim \mathcal{N}(0, \sigma_\gamma^2).$

- Ma trận chuyển tiếp trạng thái là $T = I$, ma trận quan sát là $Z_t = [1 \ y_{2t}]$, và trạng thái ban đầu là:
  - $\mu_1 \sim \mathcal{N}(\bar{\mu}_ 1, \sigma_{\mu_1}^2),$
  - $\gamma_1 \sim \mathcal{N}(\bar{\gamma}_ 1, \sigma_{\gamma_1}^2)$.

### *Spread* Chuẩn hóa
Với đòn bảy = 1 (xem công thức 15.2), *spread* chuẩn hóa có thể được tính:

$$z_t = \frac{1}{1 + \gamma_{t-1}} \left( y_{1t} - \gamma_{t-1} y_{2t} - \mu_{t-1} \right),$$

Trong đó $\mu_{t-1}$ và $\gamma_{t-1}$ là các trạng thái ẩn được ước tính bởi thuật toán Kalman.

---

## Ước tính các Tham số của Mô hình
Các tham số của mô hình không gian trạng thái ($\sigma_\epsilon^2, \sigma_\mu^2, \sigma_\gamma^2$) có thể được xác định bằng cách:

#### 1. Heuristic đơn giản:
- Sử dụng dữ liệu huấn luyện $T^{LS}$ mẫu để ước tính $\mu$ và $\gamma$ thông qua bình phương nhỏ nhất (LS).
- Tính toán phần dư của $LS_t$, sau đó xác định tham số của mô hình:

   - $\sigma_\epsilon^2 = Var[ \epsilon_t ],$

   - $\mu_1 \sim \mathcal{N}(\mu_{\mu}, \sigma_{\mu}^2),$

   - $\gamma_1 \sim \mathcal{N}(\gamma_{\gamma}, \sigma_{\gamma}^2).$

#### 2. Tham số $\alpha$:
- Xác định tỷ lệ biến động của các trạng thái ẩn thay đổi chậm so với biến động của *spread*.

---

## Mở Rộng Mô Hình Không Gian Trạng Thái
1. **Thêm Thành phần Vận tốc:**
   - Mô hình không chỉ xét đến hệ số phòng hộ $\gamma_t$ mà còn cả tốc độ thay đổi $\dot{\gamma}_t$:
   
$$\alpha_t = (\mu_t, \gamma_t, \dot{\gamma}_t),$$

dẫn đến:

```math
     \begin{bmatrix}
     \mu_{t+1} \\
     \gamma_{t+1} \\
     \dot{\gamma}_{t+1}
     \end{bmatrix}
     =
     \begin{bmatrix}
     1 & 0 & 0 \\
     0 & 1 & 1 \\
     0 & 0 & 1
     \end{bmatrix}
     \begin{bmatrix}
     \mu_t \\
     \gamma_t \\
     \dot{\gamma}_t
     \end{bmatrix}
     +
     \eta_t.
```

3. **Thành phần Tự hồi quy:**
   - Dưới khái niệm cointegration từng phần, mô hình *spread* với thành phần tự hồi quy được mở rộng:

$$\alpha_t = (\mu_t, \gamma_t, \epsilon_t),$$

dẫn đến:

```math
     \begin{bmatrix}
     \mu_{t+1} \\
     \gamma_{t+1} \\
     \epsilon_{t+1}
     \end{bmatrix}
     =
     \begin{bmatrix}
     1 & 0 & 0 \\
     0 & 1 & 0 \\
     0 & 0 & \rho
     \end{bmatrix}
     \begin{bmatrix}
     \mu_t \\
     \gamma_t \\
     \epsilon_t
     \end{bmatrix}
     +
     \eta_t,
```

trong đó $|\rho| < 1$ hoặc $\rho$ cố định ở giá trị hợp lý như $\rho = 0.9$.

### Kết luận
- Mô hình không gian trạng thái cung cấp một phương pháp linh hoạt và hiệu quả để mô hình hóa *spread* trong giao dịch cặp.
- Việc mở rộng mô hình với vận tốc hoặc thành phần tự hồi quy có thể cải thiện đáng kể hiệu suất dự báo và giao dịch.

---

## References
Anderson, B. D. O., and Moore, J. B. (1979). *Optimal Filtering*. Englewood Cliffs: Prentice Hall.

Brockwell, P. J., and Davis, R. A. (2002). *Introduction to Time Series and Forecasting*. Springer.

Chan, E. P. (2013). *Algorithmic Trading: Winning Strategies and Their Rationale*. John Wiley & Sons.

Clegg, M., and Krauss, C. (2018). *Pairs trading with partial cointegration*. Quantitative Finance, 18(1), 121–138.

Durbin, J., and Koopman, S. J. (2012). *Time Series Analysis by State Space Methods*. Oxford University Press.

Feng, Y., and Palomar, D. P. (2016). *A signal processing perspective on financial engineering. Foundations and Trends in Signal Processing*, Now Publishers, 9(1–2), 1–231.

Harvey, A. (1989). *Forecasting, Structural Time Series Models and the Kalman Filter*. Cambridge University Press.

Harvey, A., and Koopman, S. J. (2009). *Unobserved components models in economics and finance: The role of the Kalman filter in time series econometrics*. IEEE Control Systems Magazine, 29(6), 71–81.

Helske, J. (2017). *KFAS: Exponential family state space models in R. Journal of Statistical Software*, 78(10), 1–39.

Holmes, E. E., Ward, E. J., and Wills, K. (2012). *MARSS: Multivariate autoregressive state-space models for analyzing time-series data*. The R Journal, 4(1), 11–19.

Kay, S. M. (1993). *Fundamentals of Statistical Signal Processing: Estimation Theory*. Prentice Hall.
Lütkepohl, H. (2007). New Introduction to Multiple Time Series Analysis. Springer.

Petris, G., and Petrone, S. (2011). *State space models in R. Journal of Statistical Software*, 41(4), 1–25.
Scharf, L. L. (1991). Statistical Signal Processing. Addison-Wesley.

Shumway, R. H., and Stoffer, D. S. (2017). *Time Series Analysis and Its Applications*. Springer.
Tsay, R. S. (2010). Analysis of Financial Time Series. John Wiley & Sons.

Tusell, F. (2011). *Kalman filtering in R. Journal of Statistical Software*, 39(2), 1–27.

Zivot, E., Wang, J., and Koopman, S. J. (2004). *State space modeling in macroeconomics and finance using SsfPack for S+FinMetrics*. In A. Harvey, S. J. Koopman, and N. Shephard, editors, State space and unobserved component models: Theory and applications, pages 284–335. Cambridge University Press.

---

66. The Kalman filter is implemented in the R package `KFAS` (Helske, 2017) and the Python package `filterpy`. ↩︎

67. The R package `MARSS` implements algorithms for fitting state-space models to time series data (Holmes et al., 2012). ↩︎

